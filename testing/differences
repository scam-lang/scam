OLD vs. NEW
common5.s
------------------------------------------
1,34c1,38
< var z = 
< {
< var z_shared = { var shared_count = 0; this; };
< 
< function z()
<     {
<     var count = 0;
<     extends(z_shared);
<     count = count + 1;
<     shared_count = shared_count + 1;
<     this;
<     }
< };
< 
< function x()
<     {
<     extends(z());
<     }
< 
< function y()
<     {
<     extends(z());
<     }
< 
< var xish = x();
< var yish = y();
< var zish = z();
< 
< println("x's common count is ", xish . shared_count);
< println("y's common count is ", yish . shared_count);
< println("z's common count is ", zish . shared_count);
< println("x's count is ", xish . count);
< println("y's count is ", yish . count);
< println("z's count is ", zish . count);
---
> (include "inherit.lib")
> 
> (define z
>     (scope
>         (define z_shared (scope (define shared-count 0) this))
> 
>         (define (z)
>             (define count 0)
>             (extend z_shared)
>             this
>             )
>         )
>     )
> 
> (define (x)
>     (extend (z))
>     )
> 
> (define (y)
>     (extend (z))
>     )
> 
> (define xish (x))
> (define yish (y))
> (define zish (z))
> 
> (set! 'count 1 yish)
> (set! 'count 2 zish)
> 
> (set! 'shared-count 11 yish)
> (set! 'shared-count 22 xish)
> 
> (println "x's count is " (get 'count xish))
> (println "y's count is " (get 'count yish))
> (println "z's count is " (get 'count zish))
> (println "x's common count is " (get 'shared-count xish))
> (println "y's common count is " (get 'shared-count yish))
> (println "z's common count is " (get 'shared-count zish))
36,39c40
< x's common count is 3
< y's common count is 3
< z's common count is 3
< x's count is 1
---
> x's count is 0
41c42,45
< z's count is 1
---
> z's count is 2
> x's common count is 22
> y's common count is 22
> z's common count is 22
------------------------------------------
