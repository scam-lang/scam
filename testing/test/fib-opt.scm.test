(include "compile.lib")

(define (fib n)
    (if (< n 2)
        n
        (+ (fib (- n 1)) (fib (- n 2)))
        )
    )

(define x 23)
(define result)

(define s (time))
(define result (fib x))
(define f (time))
(println "(fib " x ") is " result ", " (- f s) " seconds.")

(println "compiling fib...")
(compile fib this)
(println "fib compiled.")

(define s (time))
(define result (fib x))
(define f (time))
(println "(fib " x ") is " result ", " (- f s) " seconds.")
------------------------------------------
gc 1: 0.018096s (total 0.018096s), 1988185 cells free
gc 2: 0.017765s (total 0.035861s), 1988213 cells free
gc 3: 0.018029s (total 0.053890s), 1988294 cells free
(fib 23) is 28657, 5.7588419914 seconds.
compiling fib...
fib compiled.
gc 4: 0.017596s (total 0.071486s), 1988211 cells free
gc 5: 0.017781s (total 0.089267s), 1988195 cells free
gc 6: 0.017550s (total 0.106817s), 1988191 cells free
(fib 23) is 28657, 3.5387351513 seconds.
